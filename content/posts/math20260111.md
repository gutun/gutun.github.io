---
title: 抽卡中的概率问题(3)
subtitle:
date: 2026-01-11T10:19:34+08:00
slug: 5224791
draft: false
author:
  name: GUTUN
  link:
  email:
  avatar:
description:
keywords:
license:
comment: false
weight: 0
tags:
  - 数学
  - 游戏
categories:
  - 数学
hiddenFromHomePage: false
hiddenFromSearch: false
hiddenFromRelated: false
hiddenFromFeed: false
summary:
toc: true
math: true
lightgallery: false
password:
message:
repost:
  enable: true
  url:

# See details front matter: https://fixit.lruihao.cn/documentation/content-management/introduction/#front-matter
---

<!--more-->

**前言**：前两天看到了我几年前写的有关抽卡中的概率问题的笔记。当时对于很多问题我都不太了解，我还看到我的旧博客上残留着抽卡中的概率问题(3)的草稿，一个字也没有写。我想现在我应该可以对这个问题给出一个较为完备的解答了，我打算整理一下以下内容：基于Markov链的带有保底及概率提升的抽卡建模；对于抽卡概率公示的准确性的检验方式。部分内容由AI辅助生成。

## 基于Markov链的抽卡模型

### 定义
对于$M>0$，考虑状态空间$\Sigma = \{x_0,\dots,x_{M-1},x_{M}\}$，离散时间随机过程$\{X_t, t=0,1,2\dots\}$满足对于任意$t>0$
$$P(X_t=x_0|X_{t-1}=x_{i})=p_i,~P(X_t=x_{i+1}|X_{t-1}=x_{i})=1-p_i,~i=0,\dots,M-1,$$
$$P(X_t=x_0|X_{t-1}=x_M)=1.$$
这即定义了一个Markov链。具体来说，我们将状态$x_k$理解为距离上一次出货的抽卡次数，上述模型即表示了一个带有保底$M$次的抽卡模型。如果所有$p_i$相等，即是我们理想中纯保底的抽卡模型，否则可以表示概率变化的抽卡模型，例如目前常见的二游抽卡随着抽卡次数提升抽出概率也在提升，如果我们设定当 $i< M_0$时$p_i=p_0$，而当$M_0\le i< M$时$p_i< p_{i+1}$，这即代表着带有概率提升的抽卡模型。

定义停时$\tau=\{t>0:X_t=x_0,X_0=x_0\}$，即$\tau$为从零开始或从上一次出货开始再次出货的抽卡次数，我们可以分析其期望于分布。

容易见得上述Markov链不可约常返，于是
$$E[\tau] = \frac{1}{\pi(x_0)},$$
其中$\pi(\dot)$为Markov链的平稳分布。接下来我们求其平稳分布$\pi$。

### 平稳分布

由定义，我们有对任意$x\in\Sigma$，
$$\pi(x) = \sum_{y\in\Sigma}\pi(y)p(y,x),$$
记$\pi(x_k)=\pi_k$，由定义我们有$\pi_k = \pi_{k-1}(1-p_{k-1}),k=1,\dots,M$，于是$\pi_k = \pi_0\prod_{j=0}^{k-1}(1-p_j)$,再有$\sum_{k=0}^M \pi_k = 1$解得
$$\pi_0 = \frac{1}{1 + \sum_{k=1}^M \prod_{j=0}^{k-1}(1-p_j)},$$
从而
$$\pi_k = \frac{\prod_{j=1}^{k-1}(1-p_j)}{1 + \sum_{k=1}^M \prod_{j=0}^{k-1}(1-p_j)}.$$

结合上面的分析，我们有
$$E[\tau] = 1 + \sum_{k=1}^M \prod_{j=0}^{k-1}(1-p_j).$$
特别的，如果没有概率提升，$p_i=p,i=0,\dots M-1$，那么我们有
$$E[\tau] = 1 + \sum_{k=1}^M (1 - p)^k = \frac{1 - (1-p)^{M+1}}{p}.$$
可以看到，当没有保底时，即$M\to\infty$，我们有$E[\tau]\to\frac{1}{p}$，此时即退化为几何分布的期望。

以原神为例，根据互联网上的[数据](https://zhuanlan.zhihu.com/p/522246996)，原神满足$p_i = 0.006, 1\le i \le 73, p_i = min\{p_{i-1} + 0.06, 1\}, 74\le i\le 90$。带入公式得到每次小保底期望抽数为$62.29733$。


## 抽卡分布的检验

我们已经得到了抽卡问题的完整模型，那么接下来自然的，我们希望能够对抽卡问题进行估计和检验。我们可以考虑以下几个问题：
+ 某游戏抽卡的公示概率是否真实？
+ 某游戏抽卡的概率提升机制具体参数是多少？

这分别对应的是**假设检验**和**参数估计**问题。

鉴于具体问题的分析方法多样，我们不涉及过多细节，仅做抛砖引玉。

### 假设检验

#### 朴素方法

假设某游戏公示综合抽卡概率为$p_0$，我们希望检验
$$H_0: p_{real} = p_0.$$

假设我们观察到独立同分布的抽卡次数样本$\tau_i,i=1,\dots,n$。实际上综合抽卡概率即为$\frac{1}{E[\tau]}$，或者说$E[\tau]=p_0$。那么我们有原假设下
$$\frac{\sqrt{n}\bar{\tau}_n}{\hat{\sigma}}\overset{d}{\to} N(0,1),$$
我们由此做假设检验。

#### KS检验

假设某游戏公示抽卡机制具体为上述Markov模型，其中$p_i$均给出，此时$\tau$服从多项分布，其中$P(\tau = k) = \prod_{i=0}^{k-2}(1-p_i)p_{k-1}$，记该分布为$F$。那么我们希望检验
$$H_0: \tau\sim F.$$

我们可以用常见的分布检验方法，如KS检验，Cramer-Mises检验，Anderson-Darling检验，卡方检验等。

#### 计数过程于更新过程

在实际抽卡过程中，我们可能不会在抽出时立刻停止，即最后一次可能存在一定量未抽出的抽数，对于这部分信息可以用更新过程考虑。

考虑我们连续不停的抽卡。令$\tau_k$表示第$k$次与$k-1$次出货间隔的抽数，易知$\tau_k$独立同分布地服从上述多项分布。定义更新时刻$S_k = \sum_{i=1}^{k}\tau_k$，代表第$k$次出货发生在第$S_k$抽。这样我们就定义了一个更新过程(Renewal Process)。

定义计数过程$N(t) = \max\{k: S_k\le t\}$表示$t$次抽卡出了多少货。由更新过程的理论保证：
$$\sqrt{t}\left(\frac{N(t)}{t} - \frac{1}{E[\tau]}\right) \to N\left(0, \frac{Var(\tau)}{(E[\tau])^3}\right).$$
这实际告诉我们多余的抽数不影响渐进分析。

#### 其他

此外，我们还可以用生存分析、极大似然等角度考虑这个问题，只要由足够的数据，我们就可以做假设检验。

### 参数估计

实际情况下，游戏公司往往不会公开真实抽卡机制，我们往往需要做参数估计，这实际是简单的，我们事实上由$P(\tau = k) = E[1\{\tau=k\}]$，于是给定样本$\tau_i,i=1\dots,n$，我们记$P(\tau=k)=v_k$，有矩估计$\hat{v}_k = \frac{1}{n}\sum_{i=1}^ n 1\{\tau_i = k\},k=1,\dots,N$，就可以得到$\hat{p}_k = \frac{v_{k+1}}{\sum_{i\ge k+1}v_i}$.

事实上，我们可以直接计算极大似然估计，我们有$p_k = P(X_{t} = x_0|X_{t-1} = x_{k}) = P(X_{k+1} = x_0|X_{k} = x_k) = P(\tau = k+1|\tau \ge k+1)$。所以我们可以直接计算$\hat{p}_k = \frac{\#\{\tau_k = k+1\}}{\#\{\tau_k \ge k+1\}}$。

### 实际数据检验

网上有[原神抽卡数据集](https://github.com/OneBST/GI_gacha_dataset)。如有兴趣可以拿其练手。

*于2026年1月11日*

**后记**：今天算是实现了一个多年前的愿望，给抽卡的概率问题做了个了解，使用Markov链和更新过程建模是大三的我想不到的，但是后来学到相应课程的时候想到了这个问题，却没有动力把它写下来。总的来看，这是个非常简单的问题，在AI的辅助下，我花空闲时间就完成了这篇Note。另一个角度看，对于这么一个现实中的问题，统计学可以使用的方法几乎没有超过上世纪的发展，当然我们可以进一步检验这个过程是否稳定(抽越多越容易/困难出货)，是否对不同用户一致(仓检)，是否存在变点(针对氪佬独有机制)，但是这个问题分布已经研究清楚，剩下的问题直接调用相应方面的结论即可。